<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
							"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mulcam.run.dao.MateDAO">
	
	<!-- mate and group전체게시물 조회 -->
	<select id="postList" resultType="GroupAndMate" >
		<![CDATA[
			select * from 
			((select group_articleNO as no,user_id as id, user_img as img, group_title as title,group_date as regdate,0 as likeno, 'g' as type from group1)
			union
			(select mate_articleNO as no,user_id as id, user_img as img, mate_title as title,mate_date as regdate,mate_like as likeno, 'm' as type from mate)) temp
			order by regdate desc;
		]]>
	</select>
	
	<!-- mate전체게시물 조회 -->
	<select id="mateList" resultType="mate" >
		<![CDATA[
			select * from mate order by mate_articleNO
		]]>
	</select>
	
	<!-- group전체게시물 조회 -->
		<select id="groupList" resultType="group" >
		<![CDATA[
			select * from group1 order by group_articleNO
		]]>
	</select>
	
	<!-- mate게시물 정보 조회 -->
	<select id="queryMate" resultType="mate" parameterType="int">
		<![CDATA[
			select * from mate where mate_articleNO=#{mate_articleNO}
		]]>
	</select>
	
	<!-- group게시물 정보 조회 -->
	<select id="queryGroup" resultType="group" parameterType="int">
		<![CDATA[
			select * from group1 where group_articleNO=#{group_articleNO}
		]]>
	</select>
	<!-- mate게시물 수정 -->
	<update id="updateMate" parameterType="int" >
		<![CDATA[
		update mate set mate_title=#{mate_title},mate_cont=#{mate_cont},mate_tag=#{mate_tag},
						mate_date=#{mate_date}, mate_mapinfo=#{mate_mapinfo} where mate_articleNO=#{mate_articleNO}
		]]>
	</update>
	
	<!-- group게시물 수정 -->
	<update id="updateGroup" parameterType="int" >
		<![CDATA[
		update group1 set group_title=#{group_title}, group_cont=#{group_cont}, group_ki=#{group_ki},
						group_il=#{group_ki}, group_tag=#{group_tag}, group_date=#{group_date}, group_area=#{group_area} 
						where group_articleNO=#{group_articleNO}
		]]>
	</update>
	
	<!-- mate게시물 삭제 -->
	<delete id="deleteMate" parameterType="int">
		<![CDATA[
			delete from mate where mate_articleNO=#{mate_articleNO}
		]]>
	</delete>
	
		<!-- group게시물 삭제 -->
	<delete id="deleteGroup" parameterType="int">
		<![CDATA[
			delete from group1 where group_articleNO=#{group_articleNO}
		]]>
	</delete>
	
		<!-- mate게시물 삭제시 조회수 -1변경 -->
	<update id="updateMateviews" parameterType="int" >
		<![CDATA[
		update mate set mate_views=#{mate_views} where mate_articleNO=#{mate_articleNO}
		]]>
	</update>
	
		<!-- group게시물 삭제시 조회수 -1변경 -->
	<update id="updateGroupviews" parameterType="int" >
		<![CDATA[
		update group1 set group_views=#{group_views} where group_articleNO=#{group_articleNO}
		]]>
	</update>
	
	<!-- mate게시물 생성 -->
	<insert id="insertMate" parameterType="mate">
		<![CDATA[
			insert into mate (mate_articleNO,user_id,mate_title,mate_cont,user_img,mate_like,mate_date,mate_views,mate_mapinfo,warning) 
				values(null,#{user_id},#{mate_title},#{mate_cont},#{user_img},0,now(),0,#{mate_mapinfo},false)
		]]>
	</insert>
	
		<!-- group게시물 생성 -->
	<insert id="insertGroup" parameterType="group">
		<![CDATA[
			insert into group1 (group_articleNO,user_id,group_title,group_cont,user_img,group_kl,group_il,group_date,group_area,group_views,warning) 
				values(null,#{user_id},#{group_title},#{group_cont},#{user_img},#{group_kl},#{group_il},now(),#{group_area},0,false)
		]]>
	</insert>
	
		<!-- 신고접수 -->
	<insert id="insertWarning" parameterType="warning">
		<![CDATA[
			insert into report (alert_no,board_type,board_no,comment_ref,comment_seq,alert_cnt,alert_id) 
				values(#{alert_no},#{board_type},#{board_no},#{comment_ref},#{comment_seq},#{alert_cnt},#{alert_id})
		]]>
	</insert>
	
	<!-- 참여자 조회 -->
	
 	<!-- 참여버튼 (like +1) -->
  	<update id="like" parameterType="int">
		<![CDATA[
		update mate set mate_like=mate_like+1 where mate_articleNO=#{mate_articleNO}
		]]> 
	</update> 
	
		<!-- 참여버튼 (like +1) -->
<!--   	<select id="like" parameterType="int">
		<![CDATA[
		select count(*) from ptp where mate_articleNO=#{mate_articleNO}
		]]> 
	</select> -->
	
	<!-- 참여버튼취소 (like -1) -->
	<update id="likeCancel" parameterType="int">
		<![CDATA[
		update mate set mate_like=mate_like-1 where mate_articleNO=#{mate_articleNO}
		]]> 
	</update>
	
	<!-- 번개참여시 ptp테이블에 아이디값 저장 -->
	<insert id="insertptp" parameterType="map">
		<![CDATA[
			insert into ptp (ptp_no,mate_articleNO,user_id)
			values(null,#{mate_articleNO},#{user_id})
		]]>
	</insert>
	
	<!-- 번개참여취소시 ptp테이블에 삭제 -->
		<insert id="deleteptp" parameterType="map">
		<![CDATA[
			delete from ptp where user_id=#{user_id} and mate_articleNO=#{mate_articleNO}
		]]>
	</insert>
	
	<select id="ptpInfo" resultType="ptp" parameterType="int">
		<![CDATA[
			select * from ptp where mate_articleNO=#{mate_articleNO}
		]]>
	</select>
	

</mapper>